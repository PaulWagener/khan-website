{% extends "page_template.html" %}
{% block pagescript %}
<style>
#students {
    padding: 18px 23px;
}
#students p {
    margin-top: 1.2em;
    margin-bottom: 1.2em;
}

#sidebar {
    float: left;
    width: 180px;
}
#sidebar > ul a {
    display: block;
    text-decoration: none;
    color: inherit;
}
.student-list-links {
    margin-bottom: 1.6em;
}
.student-list-links li {
    font-size: 130%;
    margin-bottom: .5em;
}
.bullet {
    padding-left: 15px;
}
/* todo: these images maybe need to be bigger! */
.bullet:hover {
    background: url('images/list-item-green.png');
    background-repeat: no-repeat;
    background-position-y: 5px;
}
.bullet-active {
    background: url('images/list-item-black.png');
    background-repeat: no-repeat;
    background-position-y: 5px;
}
#sidebar .simple-button {
    margin-left: 15px;
}

#students-container {
    margin-left:200px;
    max-width: 640px;
}
.students-header {
    padding-bottom: 0.5em;
    margin-bottom: 0;
    border-bottom: 1pt solid #aaaaaa;
}
h2 {
    display: inline;
}
h2 a:link, h2 a:visited, .student-name a:link, .student-name a:visited {
    color: #000 ! important;
    text-decoration: none;
}
h2 a:hover, .student-name a:hover {
    color: #000;
    text-decoration: underline;
}
#nstudents {
    margin-left: .5em;
}
#textbox-container {
    background: #eeeeee;
    padding-top: 1em;
    padding-bottom: 0.5em;
    padding-left: .5em;
    padding-right: .5em;
    margin-bottom: 1.4em;
}

.student-row {
    padding-top: 0.7em;
    padding-bottom: 0.7em;
    min-height: 3em;
    padding-left: 0.5em;
    padding-right: 0.5em;
}
.student-name {
    font-size: 160%;
    margin-bottom: .25em;
}
.float-right {
    float: right;
}


.lists-css-menu {
    margin-right: 2em;
    position: relative;
    top: 4px;
}
.lists-css-menu > ul > li:after {
    visibility: hidden;
    margin-left: 5px;
}
.lists-css-menu > ul > li.css-menu-js-hover:after {
    visibility: visible;
}
.student-row:hover .css-menu > ul > li:after {
    visibility: visible;
}
.student-row:hover .lists-css-menu > ul > li {
    color: #000000;
}
.lists-css-menu > ul > li > ul > li > label {
    display: block;
    padding: 4px;
    cursor: pointer;
}
.lists-css-menu .list-option-newlist {
    display: block;
    padding: 4px;
    cursor: pointer;
    border-top: 1pt solid #ddd;
}
.lists-css-menu > ul > li > ul > li:hover {
    background: white;
}
.lists-css-menu input {
    margin-right: .5em;
}
.student-row .css-menu {
    z-index: auto;
}

#newlist-box {
    display: none;
    margin-left: 15px;
    margin-bottom: 10px;
}

a.delete-button[href="#"] {
    border-bottom: none;
}

.delete-button > img {
    position: relative;
    top: 6px;
    width: 16px;
    height: 16px;
    opacity:0.2;filter:alpha(opacity=20);
}
.delete-button > img:hover {
    opacity:0.6;filter:alpha(opacity=60);
}

.student-email {
    margin-left: .5em;
}

#requested-students {
    display: none;
}
#requested-student-tmpl {
    display: none;
}

.alert {
    display: none;
    margin-top: -1.4em;
    padding: .6em;
    margin-bottom: 1.4em;
}
.alert.error {
    border: 1pt solid #C00000
}
.alert.note {
    border: 1pt solid #ddd;
}
.close-button {
    margin-left: 1em;
}
.note ul, .note li {
    list-style: circle;
    margin: .3em;
    margin-left: .8em;
}

#empty-class {
    display: none;
}

</style>
{% endblock pagescript %}

{% block pagesubmenu %}
<span class="breadcrumbs_nav">
    <a href="/students" class="selected">Manage Students</a>
    <a href="/class_profile">Class Stats</a>
</span>
{% endblock pagesubmenu %}

{% block pagecontent %}
<article id="students">

<div id="sidebar">
    <ul class="student-list-links">
        <li id="student-list-allstudents" data-list_id="allstudents"><a href="/students" class="bullet bullet-active">All students</a></li>
        <li id="student-list-requests" data-list_id="requests"><a href="/students?list_id=requests" class="bullet" title="Students that appear here have not yet responded to your request to coach them">Requests</a></li>
    </ul>
    <ul id="custom-lists" class="student-list-links">
        {% for list in student_lists %}
        <li data-list_id="{{list.key}}"><a href="students?list_id={{list.key}}" class="bullet">{{list.name|escape}}</a></li>
        {% endfor %}
    </ul>
    <input type="textbox" id="newlist-box" />
    <a id="newlist-button" class="simple-button action-gradient" href="#">Create a new list</a>
</div>

<div id="students-container">

    <div class="students-header">
        <span class="float-right">

            <a class="delete-button" id="delete-list" href="#"><img src="images/circled_cross.png" title="Delete this list (the students will still appear in 'All students')"/></a>
        </span>
        <h2><a href="/class_profile?student_list=allstudents" title="View the class statistics page for this set of students">All students</a></h2>
        <span id='nstudents'>n students</span>
    </div>

    <div id="textbox-container">
        <input type="text" id="request-student" size="80" data-blur-val="Type a student's email address to propose becoming their coach"/>
        <input type="text" id="add-to-list" size="80" data-blur-val="Type a student's name to add them to this list"/>
    </div>
    
    <div class="alert error" id="addstudent-error">
        <span class="float-right close-button">(<a href="#">close</a>)</span>
        No student was found with that ID. The student must log in at least once. Also, check that the student ID is correct. Here are some examples of student IDs:<br>
        <ul>
            <li>student@gmail.com</li>
            <li>http://facebookid.khanacademy.org/123456789</li>
        </ul>
    </div>
    <div class="alert note" id="notaccepted-note">
        <span class="float-right close-button">(<a href="#">close</a>)</span>
        The students below have not yet accepted your request to coach them. To start coaching them, have them click 'add a coach' at the bottom of any screen, then click the 'accept coach' button.
    </div>

    <div id="actual-students">
        {% for student in students %}
        <div class="student-row" data-student_id="{{student.key}}">
            <span class="float-right">
                <div class="css-menu lists-css-menu">
                    <ul>
                        <li>Edit Lists
                            <ul>
                                <li class="list-option-newlist">+ Create a new list...</li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <a class="delete-button" href="#" title="Remove this student from this list"><img src="images/circled_cross.png"/></a>
            </span>
            <div>
                <span class="student-name"><a href="/profile?student_email={{ student.email|escape }}" title="View this student's profile page">{{ student.nickname|escape }}</a></span>
                <span class="student-email">{{ student.email|escape }}</span>
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="requested-students">
        {% for email in coach_requests %}
        <div class="student-row">
            <span class="float-right">
                <a class="delete-button" href="#" title="Cancel the request to coach this student"><img src="images/circled_cross.png"/></a>
            </span>
            <div><span class="student-name">{{ email|escape }}</span></div>
        </div>
        {% endfor %}
    </div>
    
    {% empty_class_instructions 1 %}

    <div id="tmpl" style="display:none">
        <div class="student-row">
            <span class="float-right">
                <a class="delete-button" href="#" title="Cancel the request to coach this student"><img src="images/circled_cross.png"/></a>
            </span>
            <div><span class="student-name">email goes here</span></div>
        </div>
    </div>
</div>

{% if enable_tests %}
<h1 id="qunit-header">QUnit tests</h1>
<h2 id="qunit-banner"></h2>
<div id="qunit-testrunner-toolbar"></div>
<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>
<div id="qunit-fixture">test markup, will be hidden</div>
{% endif %}

</article>
{% endblock pagecontent %}

{% block bottompagescript %}
<script type="text/javascript" charset="utf-8">
$(function() {
    StudentLists.Data.students = {{students_json}};
    StudentLists.Data.student_lists = {{student_lists_json}};
    StudentLists.Data.coach_requests = {{coach_requests_json}};
    StudentLists.init();
});    
</script>
{% js_package "studentlists" %}

{% if enable_tests %}
<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>

<script type="text/javascript" charset="utf-8">
$(function() {

test("focus should return to button after textbox", function() {
    var $newlist = $('#newlist-button');
    var focusReturned = true;
    if ($newlist.length != 0) {
        $newlist.click();
        // now press escape
        var e = jQuery.Event('keyup');
        e.which = '27';
        $('#newlist-box').trigger(e);
        focusReturned = (document.activeElement == $newlist.get(0));
        equals(true, focusReturned);
    }
});

});
</script>
{% endif %}
{% endblock bottompagescript %}
