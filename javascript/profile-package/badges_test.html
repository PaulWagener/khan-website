<!DOCTYPE html>

<!-- Unit tests and demos for badge related components -->
<html>
<head>
<script src="../testbase.js"></script>
<script src="badges.js"></script>
<link rel="stylesheet" type="text/css" href="../../stylesheets/shared-package/default.css"></link>
<link rel="stylesheet" type="text/css" href="../../stylesheets/profile-package/badges.css"></link>
<script>
var badgeList = new Badges.BadgeList(),
	fullBadgeList = new Badges.BadgeList(),
	displayCase,
	imageBase = "http://khan-academy.appspot.com";

// Matches what would be sent from the server
var SAMPLE_BADGE_JSON = {
	"badgeCategory": 0,
	"badgeContextType": 1,
	"count": 4,
	"date": "2011-11-22T02:59:43Z",
	"description": "Picking Up Steam",
	"iconSrc": "/images/badges/meteorite-small.png",
	"isOwned": true,
	"isUserBadge": true,
	"listContextNames": [
		"Greatest common divisor"
	],
	"listContextNamesHidden": [
		"Division 1",
		"Division 0.5",
		"Addition 1"
	],
	"points": 100,
	"safeExtendedDescription": "Quickly & correctly answer 5 exercise problems in a row (time limit depends on exercise difficulty)",
	"targetContextName": "Greatest common divisor",
	"typeLabel": "Meteorite"
};

function addBadge( name, desc, type, list ) {
	var name = name || $("#name").val(),
		desc = desc || $("#desc").val(),
		type = ( type || $("#type").val() ).toLowerCase(),
		json = SAMPLE_BADGE_JSON;
	switch ( type ) {
		case "earth":
			json[ "badgeCategory" ] = Badges.Category.GOLD;
			break;
		case "moon":
			json[ "badgeCategory" ] = Badges.Category.SILVER;
			break;
		case "meteorite":
		default:
			type = "meteorite";
			json[ "badgeCategory" ] = Badges.Category.BRONZE;
			break;
	}
	json[ "badgeName" ] = name;
	json[ "description" ] = desc;
	json[ "iconSrc" ] = json[ "iconSrc" ].replace(
		/[a-z]*-small.png/,
		type + "-small.png"
	);
	json[ "count" ] = Math.random() * 10 | 0;

	list = list || badgeList;
	list.add( new Badges.Badge( json ) );
}

function toggleEdit( button ) {
	if ( button.innerHTML.indexOf( "Edit badges" ) >= 0 ) {
		button.innerHTML = "Stop editing";
		displayCase.edit();
	} else {
		button.innerHTML = "Edit badges";
		displayCase.stopEdit();
	}
}

KA_TEST.loadTemplates([
		"profile.badge-display-case",
		"profile.badge-compact"
		], function() {
	displayCase = new Badges.DisplayCase({ model: badgeList });
	$("#container").append( displayCase.render().el );

	addBadge( "foobadge", "Foo badge", "moon" );
	addBadge( "barbadge", "Bar badge", "earth" );

	// Populate the full, master badge list.
	addBadge( "foobadge", "Foo badge", "moon", fullBadgeList );
	addBadge( "barbadge", "Bar badge", "earth", fullBadgeList );
	addBadge( "bazbadge", "Baz badge", "meteorite", fullBadgeList );
	addBadge( "kablowbadge", "Kablow badge", "moon", fullBadgeList );
	addBadge( "powbadge", "Pow! badge", "earth", fullBadgeList );
	displayCase.setFullBadgelist( fullBadgeList );
});

</script>
</head>
<body>
<div id="container">
</div>

<div>
Name: <input id="name"><br>
Desc: <input id="desc"><br>
Type(meteorite|moon|earth): <input id="type" value="moon"><br>
<button onclick="addBadge()">Add Badge</button>
<button onclick="toggleEdit(this)">Edit badges</button>
</div>
</body>
</html>
