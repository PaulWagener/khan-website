{% macro user_info(username, user_data, logout_url) -%}
    {{ badges.badge_counts(user_data) }}
    {{ user_points(user_data) }}
    {{ username_and_notification(username, user_data, logout_url) }}
{%- endmacro %}

{% macro badges_and_points(user_data) -%}
    {{ badges.badge_counts(user_data) }}
    {{ user_points(user_data) }}
{%- endmacro %}

{% macro user_points(user_data, points=0) -%}
    {% if user_data %}
        {% if user_data.is_demo %}
            {% set profile_root = '/logout?continue=/profile' %}
            {% set points = 0 %}
        {% else %}
            {% set profile_root = user_data.profile_root %}
            {% set points = user_data.points %}
        {% endif %}
    {% else %}
        {% set profile_root = '/profile' %}
        {% set points = 0 %}
    {% endif %}
    <span id="user-points-container">{{ user_points_content(profile_root, points) }}</span>
{%- endmacro %}

{% macro user_points_content(profile_root, points) -%}
<span title="{{ points|thousands_separated }} energy points" class="energy-points-badge" onclick="location.href='{{profile_root}}'" {% if not points %} style="display: none" {% endif %}>{{ points|thousands_separated }}</span>
{%- endmacro %}

{% macro username_and_notification(username, user_data, logout_url) -%}
{% if user_data %}
    {% if user_data.is_demo %}
        {% set profile_root = '/logout?continue=/profile' %}
        {% set count = 0 %}
    {% else %}
        {% set profile_root = user_data.profile_root %}
        {% set count = user_data.feedback_notification_count() %}
    {% endif %}
{% else %}
    {% set profile_root = '/profile' %}
    {% set count = 0 %}
{% endif %}
{% if count %}
<span class="user-notification">
    <a class="notification_link" href="/discussion/videofeedbacknotificationlist" title="{{ count }} new answers to your questions"><img src="{{ "/images/email.png"|static_url }}" class="icon" style="width:16px;height:11px;"/><span class="notification_bubble">{{ count }}</span></a>
</span>
{% endif %}
<span class="dropdown">
    <span class="username_and_notification dropdown-toggle">
        <a href="{{profile_root}}" {% if user_data.is_demo %}class="show-demo-dialog"{% endif %}><img class="user-avatar" src="{{ avatars.get_src_for_user(user_data) }}"><span class="user-name">{{username|escape}}</span></a>
        <b class="caret"></b>
    </span>
    <ul class="dropdown-menu vertical-shadow">
        <li><a class="profile-link{% if user_data.is_demo %} show-demo-dialog{% endif %}" href="{{profile_root}}">Visit profile</a></li>
        <!-- TODO(marcia): Uncomment below link when some milestone of Auth launches. -->
        <!-- <li><a href="{{profile_root}}/settings">Change settings</a></li> -->
        <!-- Facebook's JS logout requires the page_logout ID -->
        <li><a id="page_logout" href="{{logout_url}}">Logout</a></li>
    </ul>
</span>
{%- endmacro %}

{% macro user_video_css(user_data) -%}
    {% if user_data %}
    {% if not user_data.is_demo %}
    <link rel='stylesheet' type='text/css' href='/user_video_css?version={{ user_data.uservideocss_version }}&id={{ user_data.user_id }}' />
    {% endif %}
    {% endif %}
{%- endmacro %}

{% macro possible_points_badge(points, possible_points, logged_in=True) -%}
<div class="video-energy-points"{% if logged_in %} title="{{ points }} Energy Points earned for watching this video"{% else %} title="You're earning points for watching this video. Sign in to keep them"{% endif %}><span class="video-energy-points-current">{{ points }}</span> of {{ possible_points }}</div>
{%- endmacro %}
