{% extends "page_template.html" %}

{% import 'macros/user.html' as user %}
{% import 'macros/youtube.html' as youtube %}
{% import 'macros/library.html' as library %}
{% import 'macros/analytics.html' as analytics %}
{% import 'macros/discussion.html' as discussion %}

{% block meta_page_title %}{{video.title|escape}} | {{topic.title|escape}} | {% endblock %}
{% block meta_keywords %}{{video.keywords}}{% endblock %}
{% block meta_description %}{{video.description}}{% endblock %}

{% block pagecss %}
    {{ js_css_packages.css_package("video") }}
{% endblock pagecss %}

{% block pagesubmenu %}
<span class="breadcrumbs_nav video-nav"></span>
{% endblock pagesubmenu %}
{% block pagecontent %}
<article id="video-page">
<div class="video" data-role="page" data-theme="b">
    <div data-role="header" class="mobile-only">
        <a href="#" data-rel="back" data-icon="arrow-l">Back</a>
        <h2 class="video-title"></h2>
        <a href="/" data-icon="home" data-iconpos="notext" data-direction="reverse"></a>
    </div>
    <div data-role="content" itemscope itemtype="http://schema.org/VideoObject">
        <div id="description" class="video-description"></div>
        <div style="margin-top: -5px;"></div>
        <span class="video-content"></span>
        <div class="desktop-only video-discussion"></div>
    </div>
    </div>
</div>
</article>
{% endblock pagecontent %}

{% block bottompagescript %}

    {{ js_css_packages.js_package("video") }}
    <script>
      window.videoData = {{ video_data_json }}

      $(function() {
        Video.init();
        VideoStats.startLoggingProgress("{{ video.key()|escapejs }}");

        Discussion.init();
        Moderation.init();
        Voting.init();
        Comments.init();
        QA.init();

        // We take the message in the title of the energy points box and place it
        // in a tooltip, and if it's the message with a link to the login we
        // replace it with a nicer link (we don't want to have to pass the url to
        // the templatetag).
        var $points = $('.video-energy-points');
        $points.data('title', $points.attr('title').replace(/Sign in/,
                   '<a href="{{ login_url|escape }}">Sign in</a>'))
               .removeAttr('title');

        VideoStats.tooltip('#points-badge-hover', $points.data('title'));
      });
    </script>
    {{ analytics.crazyegg_tracker(False) }}
{% endblock bottompagescript %}


